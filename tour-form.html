<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOURNAMENT FORM | PSL</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;800;900&family=Space+Grotesk:wght@300;400;500;600;700&family=Kanit:wght@200;300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <style>
        /* LIQUID GLASS THEME */
        :root {
            --pure-black: #000000;
            --deep-black: #0a0a0a;
            --soft-black: #111111;
            --charcoal: #1a1a1a;
            --graphite: #2a2a2a;
            
            --pure-white: #ffffff;
            --soft-white: rgba(255, 255, 255, 0.9);
            --mist-white: rgba(255, 255, 255, 0.6);
            --frost-white: rgba(255, 255, 255, 0.1);
            --ghost-white: rgba(255, 255, 255, 0.05);
            
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-highlight: rgba(255, 255, 255, 0.15);
            
            --liquid-glow: rgba(255, 255, 255, 0.3);
            --liquid-sheen: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 50%, rgba(255,255,255,0.05) 100%);
            
            --font-display: 'Orbitron', sans-serif;
            --font-body: 'Space Grotesk', 'Kanit', sans-serif;
            
            --border-radius-sm: 12px;
            --border-radius-md: 20px;
            --border-radius-lg: 28px;
            --border-radius-xl: 40px;
            
            --success: #10b981;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            background: var(--deep-black); 
            font-family: var(--font-body);
            color: var(--soft-white);
            overflow-x: hidden;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255,255,255,0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255,255,255,0.02) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
            animation: ambientMove 20s ease-in-out infinite;
        }
        
        @keyframes ambientMove {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(-2%, 2%) scale(1.1); }
        }

        /* Liquid Glass Navbar */
        .navbar { 
            background: var(--glass-bg);
            backdrop-filter: blur(20px) saturate(180%);
            padding: 16px 24px; 
            border-bottom: 1px solid var(--glass-border);
            position: sticky; 
            top: 0; 
            z-index: 100; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            box-shadow: 0 4px 30px rgba(0,0,0,0.3);
        }
        
        .brand { 
            font-family: var(--font-display); 
            font-weight: 800; 
            font-size: 1.6rem;
            color: var(--pure-white);
            letter-spacing: 2px;
        } 
        
        .brand span { 
            color: var(--mist-white);
            font-weight: 400;
        }
        
        .nav-links { display: flex; gap: 8px; }
        
        .nav-btn { 
            padding: 10px 18px; 
            border-radius: var(--border-radius-sm); 
            border: 1px solid var(--glass-border); 
            background: var(--ghost-white);
            color: var(--soft-white);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            text-decoration: none;
            transition: all 0.3s ease;
            font-family: var(--font-display);
            letter-spacing: 1px;
            font-size: 0.75rem;
            text-transform: uppercase;
            backdrop-filter: blur(10px);
        }
        
        .nav-btn:hover { 
            background: var(--glass-bg);
            border-color: var(--glass-highlight);
            color: var(--pure-white);
            transform: translateY(-2px);
        }

        /* HERO SECTION */
        .hero { 
            background: linear-gradient(180deg, transparent 0%, rgba(255,255,255,0.02) 100%);
            padding: 50px 20px; 
            text-align: center; 
            position: relative; 
            overflow: hidden;
            border-bottom: 1px solid var(--glass-border);
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(255,255,255,0.03) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .hero-title { 
            font-family: var(--font-display); 
            font-weight: 800; 
            font-size: 2.5rem; 
            color: var(--pure-white);
            position: relative; 
            z-index: 1;
            letter-spacing: 3px;
            text-transform: uppercase;
            text-shadow: 0 0 30px rgba(255,255,255,0.2);
        }
        
        .hero-sub { 
            color: var(--mist-white); 
            font-size: 1rem; 
            margin-top: 12px; 
            position: relative; 
            z-index: 1;
            font-weight: 300;
            letter-spacing: 1px;
        }

        .container { max-width: 800px; margin: 0 auto; padding: 40px 20px; }

        /* FORM CARD - Liquid Glass */
        .form-card { 
            background: var(--glass-bg);
            backdrop-filter: blur(20px) saturate(180%);
            border-radius: var(--border-radius-lg); 
            border: 1px solid var(--glass-border); 
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }
        
        .form-section { 
            margin-bottom: 30px; 
            padding-bottom: 30px; 
            border-bottom: 1px solid var(--glass-border); 
        }
        
        .form-section:last-child { 
            border-bottom: none; 
            margin-bottom: 0; 
            padding-bottom: 0; 
        }
        
        .section-title { 
            font-family: var(--font-display); 
            font-weight: 800; 
            font-size: 1.1rem; 
            color: var(--pure-white);
            margin-bottom: 20px;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i { color: var(--pure-white); }

        .form-row { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 20px; 
            margin-bottom: 20px; 
        }
        
        .form-group { margin-bottom: 20px; }
        
        .form-label { 
            display: block; 
            font-weight: 600; 
            font-size: 0.85rem; 
            margin-bottom: 8px; 
            color: var(--soft-white);
            letter-spacing: 0.5px;
        }
        
        .form-input { 
            width: 100%; 
            padding: 14px; 
            background: var(--ghost-white);
            border: 1px solid var(--glass-border); 
            border-radius: var(--border-radius-sm); 
            font-family: var(--font-body);
            color: var(--pure-white);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-input:focus { 
            outline: none; 
            border-color: var(--glass-highlight);
            background: rgba(255,255,255,0.08);
            box-shadow: 0 0 0 3px rgba(255,255,255,0.05);
        }
        
        .form-input::placeholder { color: var(--mist-white); }
        
        .form-select { 
            width: 100%; 
            padding: 14px; 
            background: var(--ghost-white);
            border: 1px solid var(--glass-border); 
            border-radius: var(--border-radius-sm); 
            font-family: var(--font-body);
            color: var(--pure-white);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .form-select:focus { 
            outline: none; 
            border-color: var(--glass-highlight);
            background: rgba(255,255,255,0.08);
        }
        
        .form-textarea { 
            width: 100%; 
            padding: 14px; 
            background: var(--ghost-white);
            border: 1px solid var(--glass-border); 
            border-radius: var(--border-radius-sm); 
            font-family: var(--font-body);
            color: var(--pure-white);
            font-size: 1rem;
            min-height: 120px;
            resize: vertical;
            transition: all 0.3s ease;
        }
        
        .form-textarea:focus { 
            outline: none; 
            border-color: var(--glass-highlight);
            background: rgba(255,255,255,0.08);
            box-shadow: 0 0 0 3px rgba(255,255,255,0.05);
        }

        /* IMAGE UPLOAD */
        .image-upload { 
            border: 2px dashed var(--glass-border); 
            border-radius: var(--border-radius-md); 
            padding: 40px; 
            text-align: center; 
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--ghost-white);
        }
        
        .image-upload:hover { 
            border-color: var(--glass-highlight);
            background: rgba(255,255,255,0.08);
        }
        
        .image-upload i { 
            font-size: 3rem; 
            color: var(--mist-white); 
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .image-upload:hover i {
            color: var(--pure-white);
        }
        
        .image-upload-text { 
            color: var(--mist-white); 
            font-size: 0.9rem;
        }
        
        .image-preview { 
            max-width: 100%; 
            border-radius: var(--border-radius-sm); 
            margin-top: 15px;
            border: 1px solid var(--glass-border);
        }

        /* BUTTONS */
        .btn-group { 
            display: flex; 
            gap: 15px; 
            margin-top: 30px; 
        }
        
        .btn { 
            flex: 1;
            padding: 16px; 
            border-radius: var(--border-radius-md); 
            border: none; 
            font-family: var(--font-display); 
            font-weight: 800; 
            font-size: 0.9rem; 
            cursor: pointer; 
            transition: all 0.3s ease;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        
        .btn-primary { 
            background: var(--pure-white);
            color: var(--pure-black); 
        }
        
        .btn-primary:hover { 
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255,255,255,0.2);
        }
        
        .btn-secondary { 
            background: var(--ghost-white);
            color: var(--soft-white); 
            border: 1px solid var(--glass-border);
        }
        
        .btn-secondary:hover { 
            background: var(--glass-bg);
            border-color: var(--glass-highlight);
            color: var(--pure-white);
        }
        
        .btn-danger { 
            background: transparent;
            color: #ef4444; 
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .btn-danger:hover { 
            background: rgba(239, 68, 68, 0.2);
        }

        /* CHECKBOX */
        .checkbox-group { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            margin-bottom: 15px; 
        }
        
        .checkbox-group input[type="checkbox"] { 
            width: 20px; 
            height: 20px; 
            cursor: pointer;
            accent-color: var(--pure-white);
        }
        
        .checkbox-group label { 
            color: var(--soft-white); 
            cursor: pointer;
        }

        .img-tab {
            padding: 9px 18px; border-radius: var(--border-radius-sm);
            border: 1px solid var(--glass-border); background: var(--ghost-white);
            color: var(--mist-white); font-size: 0.8rem; font-weight: 700;
            cursor: pointer; transition: all 0.25s; font-family: var(--font-display);
            letter-spacing: 1px; text-transform: uppercase; display: inline-flex;
            align-items: center; gap: 6px;
        }
        .img-tab.active {
            background: var(--pure-white); color: var(--pure-black); border-color: var(--pure-white);
        }
        .img-tab:hover:not(.active) { border-color: var(--glass-highlight); color: var(--soft-white); }

        @media (max-width: 768px) {
            .hero-title { font-size: 1.8rem; }
            .form-row { grid-template-columns: 1fr; }
            .btn-group { flex-direction: column; }
            .form-card { padding: 24px; }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="brand">PSL <span>ADMIN</span></div>
        <div class="nav-links">
            <a href="admin.html" class="nav-btn"><i class="fa-solid fa-arrow-left"></i> Back</a>
            <a href="index.html" class="nav-btn"><i class="fa-solid fa-home"></i></a>
        </div>
    </nav>

    <div class="hero">
        <div class="hero-title">TOURNAMENT FORM</div>
        <div class="hero-sub">Create or edit tournament details</div>
    </div>

    <div class="container">
        <div class="form-card">
            <form id="tournamentForm">
                <!-- BASIC INFO -->
                <div class="form-section">
                    <div class="section-title"><i class="fa-solid fa-info-circle"></i> Basic Information</div>
                    
                    <div class="form-group">
                        <label class="form-label">Tournament Name *</label>
                        <input type="text" class="form-input" id="tourName" placeholder="Enter tournament name" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Game *</label>
                            <select class="form-select" id="tourGame" required>
                                <option value="">Select Game</option>
                                <option value="RoV">RoV</option>
                                <option value="MLBB">MLBB</option>
                                <option value="PUBG">PUBG Mobile</option>
                                <option value="Valorant">Valorant</option>
                                <option value="FC25">FC 25</option>
                                <option value="Free Fire">Free Fire</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="tourStatus">
                                <option value="open">Open</option>
                                <option value="closed">Closed</option>
                                <option value="ongoing">Ongoing</option>
                                <option value="finished">Finished</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-textarea" id="tourDesc" placeholder="Enter tournament description..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Rules (‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°)</label>
                        <textarea class="form-textarea" id="tourRules" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..." style="min-height:100px;"></textarea>
                    </div>
                </div>

                <!-- DETAILS -->
                <div class="form-section">
                    <div class="section-title"><i class="fa-solid fa-calendar-alt"></i> Tournament Details</div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Start Date *</label>
                            <input type="date" class="form-input" id="tourDate" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Start Time</label>
                            <input type="time" class="form-input" id="tourTime">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Max Teams *</label>
                            <input type="number" class="form-input" id="tourMaxTeams" placeholder="e.g. 32" min="2" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Prize Pool</label>
                            <input type="text" class="form-input" id="tourPrize" placeholder="e.g. 50,000 THB">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Entry Fee (‡∏Ñ‡πà‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£)</label>
                            <input type="text" class="form-input" id="tourFee" placeholder="e.g. 200 THB ‡∏´‡∏£‡∏∑‡∏≠ Free">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Team Size</label>
                            <input type="number" class="form-input" id="tourTeamSize" placeholder="e.g. 5" min="1" max="10">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Format</label>
                            <select class="form-select" id="tourFormat">
                                <option value="Single Elimination">Single Elimination</option>
                                <option value="Double Elimination">Double Elimination</option>
                                <option value="Round Robin">Round Robin</option>
                                <option value="Swiss">Swiss</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Mode</label>
                            <select class="form-select" id="tourMode">
                                <option value="BO1">BO1</option>
                                <option value="BO3">BO3</option>
                                <option value="BO5">BO5</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- IMAGE -->
                <div class="form-section">
                    <div class="section-title"><i class="fa-solid fa-image"></i> Tournament Image</div>

                    <!-- Tab toggle -->
                    <div style="display:flex;gap:8px;margin-bottom:16px;">
                        <button type="button" class="img-tab active" id="tabUrl" onclick="switchImgTab('url')">
                            <i class="fa-solid fa-link"></i> URL
                        </button>
                        <button type="button" class="img-tab" id="tabFile" onclick="switchImgTab('file')">
                            <i class="fa-solid fa-upload"></i> Upload File
                        </button>
                    </div>

                    <!-- URL input -->
                    <div id="imgUrlSection">
                        <input type="url" class="form-input" id="tourImageUrl" placeholder="https://example.com/image.jpg"
                               oninput="previewFromUrl(this.value)" onpaste="setTimeout(()=>previewFromUrl(this.value),50)">
                    </div>

                    <!-- File upload -->
                    <div id="imgFileSection" style="display:none;">
                        <div class="image-upload" onclick="document.getElementById('tourImage').click()">
                            <i class="fa-solid fa-cloud-upload-alt"></i>
                            <div class="image-upload-text">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ</div>
                        </div>
                        <input type="file" id="tourImage" style="display:none;" accept="image/*" onchange="previewImageFile(event)">
                    </div>

                    <!-- Preview box -->
                    <div id="imgPreviewBox" style="display:none;margin-top:14px;position:relative;border-radius:var(--border-radius-md);overflow:hidden;border:1px solid var(--glass-border);background:var(--charcoal);">
                        <img id="imagePreview" style="width:100%;max-height:280px;object-fit:contain;display:block;">
                        <div style="position:absolute;top:8px;right:8px;">
                            <button type="button" onclick="clearImgPreview()" style="background:rgba(0,0,0,0.7);border:1px solid var(--glass-border);color:var(--mist-white);border-radius:8px;padding:4px 10px;cursor:pointer;font-size:0.8rem;">
                                <i class="fa-solid fa-xmark"></i> ‡∏•‡∏ö
                            </button>
                        </div>
                        <div id="imgPreviewLabel" style="position:absolute;bottom:0;left:0;right:0;padding:8px 12px;background:rgba(0,0,0,0.6);font-size:0.75rem;color:var(--mist-white);font-family:var(--font-display);letter-spacing:1px;">PREVIEW</div>
                    </div>
                    <div id="imgErrorMsg" style="display:none;color:#ef4444;font-size:0.8rem;margin-top:8px;"><i class="fa-solid fa-circle-exclamation"></i> ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à URL</div>
                </div>

                <!-- SETTINGS -->
                <div class="form-section">
                    <div class="section-title"><i class="fa-solid fa-cog"></i> Settings</div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="tourPublic" checked>
                        <label for="tourPublic">Make tournament public</label>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="tourRegistration">
                        <label for="tourRegistration">Allow team registration</label>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="tourCheckin">
                        <label for="tourCheckin">Require team check-in</label>
                    </div>
                </div>

                <!-- BUTTONS -->
                <div class="btn-group">
                    <button type="button" class="btn btn-secondary" onclick="cancelForm()">Cancel</button>
                    <button type="button" class="btn btn-danger" id="deleteBtn" style="display: none;" onclick="deleteTournament()">Delete</button>
                    <button type="submit" class="btn btn-primary">Save Tournament</button>
                </div>
            </form>
        </div>
    </div>

    <script type="module">
        import { db } from './firebase-config.js';
        import { collection, addDoc, doc, getDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const urlParams = new URLSearchParams(window.location.search);
        const editId = urlParams.get('id');

        // ‚îÄ‚îÄ Edit mode ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        if (editId) {
            document.querySelector('.hero-title').innerText = 'EDIT TOURNAMENT';
            document.getElementById('deleteBtn').style.display = 'block';
            loadTournamentData();
        }

        async function loadTournamentData() {
            try {
                const snap = await getDoc(doc(db, 'tournaments', editId));
                if (!snap.exists()) { alert('Tournament not found'); return; }
                const d = snap.data();
                document.getElementById('tourName').value     = d.title       || '';
                document.getElementById('tourGame').value     = d.game        || '';
                document.getElementById('tourStatus').value   = d.status      || 'open';
                document.getElementById('tourDesc').value     = d.description || '';
                document.getElementById('tourRules').value    = d.rules       || '';
                document.getElementById('tourDate').value     = d.date        || '';
                document.getElementById('tourTime').value     = d.time        || '';
                document.getElementById('tourMaxTeams').value = d.maxTeams    || '';
                document.getElementById('tourPrize').value    = d.prize       || '';
                document.getElementById('tourFee').value      = d.fee         || '';
                document.getElementById('tourTeamSize').value = d.teamSize    || '';
                document.getElementById('tourFormat').value   = d.format      || 'Single Elimination';
                document.getElementById('tourMode').value     = d.mode        || 'BO1';
                document.getElementById('tourPublic').checked       = d.isPublic           !== false;
                document.getElementById('tourRegistration').checked = d.allowRegistration  || false;
                document.getElementById('tourCheckin').checked      = d.requireCheckin     || false;
                if (d.img) {
                    document.getElementById('tourImageUrl').value = d.img;
                    showPreview(d.img);
                }
            } catch (e) { alert('Error loading: ' + e.message); }
        }

        // ‚îÄ‚îÄ Image Tab switch ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        window.switchImgTab = (tab) => {
            document.getElementById('tabUrl').classList.toggle('active', tab === 'url');
            document.getElementById('tabFile').classList.toggle('active', tab === 'file');
            document.getElementById('imgUrlSection').style.display  = tab === 'url'  ? 'block' : 'none';
            document.getElementById('imgFileSection').style.display = tab === 'file' ? 'block' : 'none';
        };

        // ‚îÄ‚îÄ Image preview helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function showPreview(src) {
            const box   = document.getElementById('imgPreviewBox');
            const img   = document.getElementById('imagePreview');
            const err   = document.getElementById('imgErrorMsg');
            img.onload  = () => { box.style.display = 'block'; err.style.display = 'none'; };
            img.onerror = () => { box.style.display = 'none';  err.style.display = 'block'; };
            img.src     = src;
        }

        window.previewFromUrl = (val) => {
            const url = val.trim();
            document.getElementById('imgErrorMsg').style.display = 'none';
            if (!url) { document.getElementById('imgPreviewBox').style.display = 'none'; return; }
            showPreview(url);
        };

        window.previewImageFile = (event) => {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                // Store base64 in hidden url field so it saves
                document.getElementById('tourImageUrl').value = e.target.result;
                showPreview(e.target.result);
            };
            reader.readAsDataURL(file);
        };

        window.clearImgPreview = () => {
            document.getElementById('tourImageUrl').value = '';
            document.getElementById('imagePreview').src  = '';
            document.getElementById('imgPreviewBox').style.display = 'none';
            document.getElementById('imgErrorMsg').style.display   = 'none';
        };

        // ‚îÄ‚îÄ Save ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        document.getElementById('tournamentForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('tourName').value.trim();
            const game = document.getElementById('tourGame').value;
            if (!name) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏±‡∏ß‡∏£‡πå'); return; }
            if (!game) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Å‡∏°'); return; }

            const btn = e.submitter || document.querySelector('.btn-primary');
            btn.textContent = 'Saving...'; btn.disabled = true;

            const data = {
                title:             name,
                game:              game,
                status:            document.getElementById('tourStatus').value,
                description:       document.getElementById('tourDesc').value.trim(),
                rules:             document.getElementById('tourRules').value.trim(),
                date:              document.getElementById('tourDate').value,
                time:              document.getElementById('tourTime').value,
                maxTeams:          parseInt(document.getElementById('tourMaxTeams').value) || 32,
                prize:             document.getElementById('tourPrize').value.trim(),
                fee:               document.getElementById('tourFee').value.trim(),
                teamSize:          parseInt(document.getElementById('tourTeamSize').value) || null,
                format:            document.getElementById('tourFormat').value,
                mode:              document.getElementById('tourMode').value,
                img:               document.getElementById('tourImageUrl').value.trim(),
                isPublic:          document.getElementById('tourPublic').checked,
                allowRegistration: document.getElementById('tourRegistration').checked,
                requireCheckin:    document.getElementById('tourCheckin').checked,
                updatedAt:         new Date().toISOString(),
            };

            try {
                if (editId) {
                    // preserve currentTeams when editing
                    await updateDoc(doc(db, 'tournaments', editId), data);
                    alert('‚úÖ Tournament updated!');
                } else {
                    data.currentTeams = 0;
                    data.createdAt    = new Date().toISOString();
                    await addDoc(collection(db, 'tournaments'), data);
                    alert('‚úÖ Tournament created!');
                }
                window.location.href = 'admin.html';
            } catch (err) {
                alert('‚ùå Error: ' + err.message);
                btn.textContent = 'Save Tournament'; btn.disabled = false;
            }
        });

        // ‚îÄ‚îÄ Cancel / Delete ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        window.cancelForm = () => {
            if (confirm('Discard changes?')) window.location.href = 'admin.html';
        };

        window.deleteTournament = async () => {
            if (!confirm('‡∏•‡∏ö‡∏ó‡∏±‡∏ß‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏ñ‡∏≤‡∏ß‡∏£? ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ')) return;
            const btn = document.getElementById('deleteBtn');
            btn.textContent = 'Deleting...'; btn.disabled = true;
            try {
                await deleteDoc(doc(db, 'tournaments', editId));
                alert('üóëÔ∏è Tournament deleted');
                window.location.href = 'admin.html';
            } catch (err) {
                alert('‚ùå ' + err.message);
                btn.textContent = 'Delete'; btn.disabled = false;
            }
        };
    </script>
</body>
</html>
